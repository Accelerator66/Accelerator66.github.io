(function(t){function i(i){for(var n,o,h=i[0],r=i[1],c=i[2],u=0,f=[];u<h.length;u++)o=h[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);l&&l(i);while(f.length)f.shift()();return s.push.apply(s,c||[]),e()}function e(){for(var t,i=0;i<s.length;i++){for(var e=s[i],n=!0,h=1;h<e.length;h++){var r=e[h];0!==a[r]&&(n=!1)}n&&(s.splice(i--,1),t=o(o.s=e[0]))}return t}var n={},a={app:0},s=[];function o(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=t,o.c=n,o.d=function(t,i,e){o.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,i){if(1&i&&(t=o(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)o.d(e,n,function(i){return t[i]}.bind(null,n));return e},o.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(i,"a",i),i},o.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},o.p="";var h=window["webpackJsonp"]=window["webpackJsonp"]||[],r=h.push.bind(h);h.push=i,h=h.slice();for(var c=0;c<h.length;c++)i(h[c]);var l=r;s.push([0,"chunk-vendors"]),e()})({0:function(t,i,e){t.exports=e("56d7")},1:function(t,i){},2:function(t,i){},"56d7":function(t,i,e){"use strict";e.r(i);e("e260"),e("e6cf"),e("cca6"),e("a79d");var n=e("7a23");function a(t,i,e,a,s,o){var h=Object(n["resolveComponent"])("Canvas");return Object(n["openBlock"])(),Object(n["createBlock"])(h,{width:650,height:650})}e("b0c0");var s=Object(n["withScopeId"])("data-v-8e34b1bc");Object(n["pushScopeId"])("data-v-8e34b1bc");var o={class:"author-div"},h={ref:"myAudio",crossorigin:"anonymous"},r=Object(n["createTextVNode"])("Upload Music"),c={ref:"upload",type:"file",hidden:""};Object(n["popScopeId"])();var l=s((function(t,i,e,a,l,u){var f=Object(n["resolveComponent"])("el-button");return Object(n["openBlock"])(),Object(n["createBlock"])("div",null,[Object(n["createVNode"])("div",{style:{width:"".concat(l.width,"px"),height:"".concat(l.height,"px")},class:"outer-div"},[Object(n["createVNode"])("div",{class:"name-div",style:{"font-size":"".concat(u.fontSizeName,"px")}},Object(n["toDisplayString"])(void 0!==this.player.musicName?t.name=this.player.musicName:""),5),Object(n["createVNode"])("div",o,Object(n["toDisplayString"])(void 0!==this.player.musicAuthor?t.name=this.player.musicAuthor:""),1),Object(n["createVNode"])("div",{class:"album-div",style:{"font-size":"".concat(u.fontSizeAlbum,"px")}},Object(n["toDisplayString"])(void 0!==this.player.musicALbum?t.name=this.player.musicALbum:""),5)],4),Object(n["createVNode"])("canvas",{ref:"info",class:"center cvs",onClick:i[1]||(i[1]=function(){return u.change_music_state.apply(u,arguments)})},null,512),Object(n["createVNode"])("audio",h,null,512),Object(n["createVNode"])(f,{class:"add-btn",type:"text",onClick:u.click_input},{default:s((function(){return[r]})),_:1},8,["onClick"]),Object(n["createVNode"])("input",c,null,512)])})),u=(e("cb29"),e("a630"),e("a15b"),e("d81d"),e("90d7"),e("d3b7"),e("3ca3"),e("5cc6"),e("9a8c"),e("a975"),e("735e"),e("c1ac"),e("d139"),e("3a7b"),e("d5d6"),e("82f8"),e("e91f"),e("60bd"),e("5f96"),e("3280"),e("3fcc"),e("ca91"),e("25a1"),e("cd26"),e("3c5d"),e("2954"),e("649e"),e("219c"),e("170b"),e("b39a"),e("72f7"),e("ddb0"),e("2b3d"),e("2ef0")),f=e.n(u),p=(e("2daf"),e("cb96")),d=30,m=8,y=3,v=.8,g=.5,x=.012,b=.007,I=10;function M(t,i,e,n){var a=Math.round(e+i*Math.sin(t)),s=Math.round(n-i*Math.cos(t));return{x:a,y:s}}function w(){return this}function P(){return this}w.prototype.init=function(t,i,e,n){this.v={x:0,y:0},this.theta=Math.random()*Math.PI*2;var a=Math.random()*(v-g)+g;this.v.x=a*Math.sin(this.theta),this.v.y=a*-Math.cos(this.theta),this.r=Math.random()*(m-y)+y;var s=M(this.theta,e+n+I,t,i);this.cx=s.x,this.cy=s.y,this.opacity=1,this.vopa=Math.random()*(x-b)+b},w.prototype.next=function(t,i,e,n){this.cx+=this.v.x,this.cy+=this.v.y,this.opacity-=this.vopa,this.opacity<=0&&this.init(t,i,e,n)},w.prototype.draw=function(t){t.beginPath();var i=t.globalAlpha;t.arc(this.cx,this.cy,this.r,0,2*Math.PI),t.globalAlpha=this.opacity,t.fill(),t.globalAlpha=i},P.prototype.init=function(t,i,e,n){this.num=d,this.list=[];for(var a=0;a<this.num;a++){var s=new w;s.init(t,i,e,n),this.list.push(s)}},P.prototype.next=function(t,i,e,n){for(var a=0;a<this.num;a++)this.list[a].next(t,i,e,n)},P.prototype.draw=function(t){for(var i=0;i<this.num;i++)this.list[i].draw(t)};var A=30,_=8,S=3,O=.8,j=.5,R=.012,k=.007,C=10;function F(t,i,e,n){var a=Math.round(e+i*Math.sin(t)),s=Math.round(n-i*Math.cos(t));return{x:a,y:s}}function N(){return this}function B(){return this}N.prototype.init=function(t,i,e,n){this.v={x:0,y:0},this.theta=Math.random()*Math.PI*2;var a=Math.random()*(O-j)+j;this.v.x=a*Math.sin(this.theta),this.v.y=a*-Math.cos(this.theta),this.r=Math.random()*(_-S)+S;var s=F(this.theta,e+n+C,t,i);this.cx=s.x,this.cy=s.y,this.opacity=1,this.vopa=Math.random()*(R-k)+k},N.prototype.next=function(t,i,e,n){this.cx+=this.v.x,this.cy+=this.v.y,this.opacity-=this.vopa,this.opacity<=0&&this.init(t,i,e,n)},N.prototype.draw=function(t){t.beginPath();for(var i=2*Math.PI/10,e=t.globalAlpha,n=11;0!=n;n--){var a=this.r*(n%2+1)/2,s=i*n;t.lineTo(a*Math.sin(s)+this.cx,a*Math.cos(s)+this.cy)}t.globalAlpha=this.opacity,t.fill(),t.globalAlpha=e},B.prototype.init=function(t,i,e,n){this.num=A,this.list=[];for(var a=0;a<this.num;a++){var s=new N;s.init(t,i,e,n),this.list.push(s)}},B.prototype.next=function(t,i,e,n){for(var a=0;a<this.num;a++)this.list[a].next(t,i,e,n)},B.prototype.draw=function(t){for(var i=0;i<this.num;i++)this.list[i].draw(t)};var T=B,z={name:"Canvas",data:function(){return{height:650,width:650,FFTsz:2048,Smoothing:.9,powBaseRatio:.25,barNumBase:Math.log2(this.FFTsz),bars:[],info:null,ctxInfo:null,music:null,myAudioContext:null,click_count:0,ratio:null,innerR:190,avgF:0,particles:null,fileInput:null,angle:0,step:.01*Math.PI,scaleR:2,scaleStep:.25,v:1,color_groups:[[{pos:0,code:"rgb(122,161,210)"},{pos:.4,code:"rgb(219,212,180)"},{pos:.7,code:"rgb(204,149,192)"}],[{pos:0,code:"rgb(247,121,125)"},{pos:.4,code:"rgb(251,215,134)"},{pos:.7,code:"rgb(198,255,221)"}]],player:{musicPath:null,musicName:"等待上传",musicAuthor:"请上传MP3文件",musicALbum:"如果上传后没有自动开始播放，需要点击圆圈",musicState:"ready"},analyser:null,AudioContext:null,requestAnimationFrame:null,cancelAnimationFrame:null}},computed:{fontSizeName:function(){return this.player.musicName?Math.max(35-(this.player.musicName.length>6?1:0)*Math.round((this.player.musicName.length-6)/2),20):35},fontSizeAlbum:function(){return this.player.musicALbum?Math.max(12-(this.player.musicALbum.length>16?1:0)*Math.round((this.player.musicALbum.length-16)/4),8):12}},mounted:function(){var t=this;window.onload=function(){t.myAudioContext=new AudioContext,t.info=t.$refs.info,t.ctxInfo=t.info.getContext("2d"),t.music=t.$refs.myAudio,t.particles=new T,console.log("Resume"),t.fileInput=t.$refs.upload,t.fileInput.onchange=function(){var i=URL.createObjectURL(t.fileInput.files[0]);console.log(i),t.change_music(i)},t.draw_all()}},methods:{click_input:function(){void 0!==this.fileInput&&null!==this.fileInput&&this.fileInput.click()},prepare_pic:function(){var t=this.myAudioContext.createMediaElementSource(this.music);this.analyser=this.myAudioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=this.Smoothing,t.connect(this.analyser),this.analyser.connect(this.myAudioContext.destination);var i=this.myAudioContext.createScriptProcessor(1024);i.connect(this.myAudioContext.destination),this.analyser.connect(i)},thetaR2xy:function(t,i,e,n){var a=Math.round(e+i*Math.sin(t)),s=Math.round(n-i*Math.cos(t));return{x:a,y:s}},draw_smooth_curve:function(t,i,e,n,a){for(var s=e.length,o=function(t){return(t+s)%s},h=function(t,i){return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}},r=0;r<s;r++)if(0===r){var c=2*Math.PI*o(r-1)/s,l=2*Math.PI*o(r)/s,u=2*Math.PI*o(r+1)/s,f=this.thetaR2xy(c,i[e[o(r-1)]],n,a),p=this.thetaR2xy(l,i[e[o(r)]],n,a),d=this.thetaR2xy(u,i[e[o(r+1)]],n,a),m=h(f,p),y=h(p,d);t.moveTo(m.x,m.y),t.quadraticCurveTo(p.x,p.y,y.x,y.y)}else{var v=2*Math.PI*o(r)/s,g=2*Math.PI*o(r+1)/s,x=this.thetaR2xy(v,i[e[o(r)]],n,a),b=this.thetaR2xy(g,i[e[o(r+1)]],n,a),I=h(x,b);t.quadraticCurveTo(x.x,x.y,I.x,I.y)}},draw_pic:function(t,i,e,n){var a=this,s={x:i/(2*this.ratio),y:e/(2*this.ratio)},o=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(o);var h=Array.from(o),r=0;if(null!==h&&void 0!==h){for(var c=0;c<h.length;c++)r+=h[c]/255;r=r/h.length*50}this.avgF=Math.min(r,50);var l=h.map((function(t){return n+a.avgF+t/3})),u=Math.pow(2,this.powBaseRatio),p=[],d=0;while(1){var m=Math.round(Math.pow(u,d)-1);if(m>=l.length)break;p.push(m),d++}var y=f.a.uniq(p);t.beginPath(),t.lineWidth=3,this.draw_smooth_curve(t,l,y,s.x,s.y),t.stroke()},draw_info:function(){this.ctxInfo.clearRect(0,0,this.info.width,this.info.height),this.ctxInfo.save();for(var t=this.info.width/(2*this.ratio),i=this.info.height/(2*this.ratio),e=this.ctxInfo.createRadialGradient(t,i,this.innerR+this.avgF,t,i,275),n=1,a=0;a<this.color_groups[n].length;a++)e.addColorStop(this.color_groups[n][a].pos,this.color_groups[n][a].code);this.ctxInfo.beginPath(),this.ctxInfo.strokeStyle=e,this.ctxInfo.fillStyle=e,this.ctxInfo.lineWidth=3;var s=0;this.player.musicPath&&(s=this.music.currentTime/this.music.duration*2*Math.PI),this.ctxInfo.arc(t,i,this.innerR+this.avgF,-Math.PI/2,-Math.PI/2+s);var o=this.ctxInfo.globalAlpha;this.ctxInfo.globalAlpha=.3,this.ctxInfo.stroke(),this.ctxInfo.beginPath(),this.ctxInfo.lineWidth=2,this.ctxInfo.arc(t,i,this.innerR+this.avgF,-Math.PI/2+s,3*Math.PI/2),this.ctxInfo.globalAlpha=.7,this.ctxInfo.stroke(),this.ctxInfo.globalAlpha=o,this.draw_pic(this.ctxInfo,this.info.width,this.info.height,200),this.particles.draw(this.ctxInfo),this.particles.next(this.info.width/(2*this.ratio),this.info.height/(2*this.ratio),this.innerR,this.avgF);var h=this.info.width/(2*this.ratio)+Math.sin(s)*(this.innerR+this.avgF),r=this.info.height/(2*this.ratio)-Math.cos(s)*(this.innerR+this.avgF);this.ctxInfo.beginPath(),this.ctxInfo.arc(h,r,this.scaleR,0,2*Math.PI),this.ctxInfo.fillStyle="rgba(255,255,255,0.3)",this.ctxInfo.fill(),this.ctxInfo.beginPath(),this.ctxInfo.arc(h,r,8,0,2*Math.PI),this.ctxInfo.fillStyle="rgba(255,255,255,0.9)",this.ctxInfo.fill(),this.ctxInfo.beginPath(),this.ctxInfo.lineWidth=6,this.ctxInfo.arc(h,r,15,this.angle,this.angle+Math.PI/3),this.ctxInfo.strokeStyle="rgba(255,255,255,0.7)",this.ctxInfo.stroke(),this.ctxInfo.beginPath(),this.ctxInfo.lineWidth=6,this.ctxInfo.arc(h,r,15,this.angle+Math.PI,this.angle+4*Math.PI/3),this.ctxInfo.strokeStyle="rgba(255,255,255,0.7)",this.ctxInfo.stroke(),this.ctxInfo.restore(),this.angle=this.angle+this.step,this.angle>=2*Math.PI&&(this.angle=this.angle-2*Math.PI),this.scaleR+=this.scaleStep*this.v,this.scaleR>=32&&(this.v=-1),this.scaleR<=2&&(this.v=1)},init_music:function(){var t=this;if(void 0!==this.fileInput&&this.fileInput.files.length>0&&p["parseBlob"](this.fileInput.files[0]).then((function(i){t.player.musicName=i.common.title,i.common.artist?t.player.musicAuthor=i.common.artist:i.common.artists?t.player.musicAuthor=i.common.artists.join(" & "):t.player.musicAuthor=void 0,t.player.musicALbum=i.common.album})).catch((function(t){console.error(t.message)})),""!==this.player.musicPath){this.music.src=this.player.musicPath,this.music.load();var i=this.music.play();void 0!==i&&i.then((function(i){console.log("music play successfully."),t.player.musicState="playing"})).catch((function(t){console.log(t)}))}},change_music:function(t){void 0===this.music||null===this.music?(this.player.musicPath=t,this.player.musicState="ready",this.init_music()):(this.music.pause(),this.player.musicPath=t,this.init_music())},change_music_state:function(){var t=this;if(this.click_count+=1,1==this.click_count)this.myAudioContext.resume().then((function(){console.log("AudioContext resume successfully."),t.init_music()}));else{if(""===this.player.musicPath)return;"ready"===this.player.musicState?this.init_music():"paused"===this.player.musicState?(this.music.play(),this.player.musicState="playing"):"playing"===this.player.musicState&&(this.music.pause(),this.player.musicState="paused")}},init_canvas:function(t,i){t.width=this.width,t.height=this.height;var e=window.devicePixelRatio||1,n=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1;if(this.ratio=e/n,e!==n){var a=t.width,s=t.height;t.width=a*this.ratio,t.height=s*this.ratio,t.style.width=a+"px",t.style.height=s+"px",i.scale(this.ratio,this.ratio)}},initCanvases:function(){this.init_canvas(this.info,this.ctxInfo)},draw_all:function(){var t=this,i=function i(){t.draw_info(),requestAnimationFrame(i)};this.prepare_pic(),this.initCanvases(),this.particles.init(this.info.width/(2*this.ratio),this.info.height/(2*this.ratio),this.innerR,this.avgF),requestAnimationFrame(i)}}};e("c35e");z.render=l,z.__scopeId="data-v-8e34b1bc";var L=z,V={name:"App",components:{Canvas:L}};e("64be");V.render=a;var q=V,W=e("46bd"),D=e.n(W),U=(e("7dd6"),Object(n["createApp"])(q));U.use(D.a),U.mount("#app")},"64be":function(t,i,e){"use strict";e("c894")},"6e9b":function(t,i,e){},c35e:function(t,i,e){"use strict";e("6e9b")},c894:function(t,i,e){}});
//# sourceMappingURL=app.be6beed5.js.map